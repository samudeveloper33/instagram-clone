{% extends 'base.html' %}
{% block content %}
  <div class="bg-gray-50 min-h-screen w-full max-w-full overflow-x-hidden">
    <div class="w-full max-w-full px-2 md:px-4 lg:px-8 py-4 md:py-8 overflow-x-hidden">
      <div class="max-w-5xl mx-auto">
        <!-- Page Title -->
        <div class="mb-6">
          <h1 class="text-2xl font-bold text-gray-900">Explore</h1>
          <p class="text-gray-600 text-sm mt-1">Discover new posts from people around the world</p>
        </div>

        <!-- Posts Grid -->
        {% if explore_posts %}
          <div class="grid grid-cols-3 gap-1 md:gap-4">
            {% for post in explore_posts %}
              {% with first_media=post.get_first_media %}
                {% if first_media %}
                  <div class="aspect-square bg-gray-200 cursor-pointer relative group overflow-hidden" 
                       onclick="openPostModal('{{ post.id }}')">
                    {% if first_media.media_type == 'image' %}
                      <img src="{{ first_media.media_file.url }}" 
                           alt="Post" 
                           class="w-full h-full object-cover transition-transform duration-200 group-hover:scale-110" />
                    {% elif first_media.media_type == 'video' %}
                      <video class="w-full h-full object-cover" muted>
                        <source src="{{ first_media.media_file.url }}" type="video/mp4">
                      </video>
                      <!-- Video indicator -->
                      <div class="absolute top-2 right-2">
                        <svg class="w-5 h-5 text-white drop-shadow-lg" fill="currentColor" viewBox="0 0 24 24">
                          <path d="M8 5v14l11-7z"/>
                        </svg>
                      </div>
                    {% endif %}
                    
                    <!-- Hover overlay with stats -->
                    <div class="absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center">
                      <div class="flex items-center space-x-6 text-white">
                        <!-- Likes -->
                        <div class="flex items-center space-x-2">
                          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                          </svg>
                          <span class="font-semibold">{{ post.likes_count }}</span>
                        </div>
                        <!-- Comments -->
                        <div class="flex items-center space-x-2">
                          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                          </svg>
                          <span class="font-semibold">{{ post.comments_count }}</span>
                        </div>
                      </div>
                    </div>

                    <!-- Multiple images indicator -->
                    {% if post.media_files.count > 1 %}
                      <div class="absolute top-2 right-2">
                        <svg class="w-5 h-5 text-white drop-shadow-lg" fill="currentColor" viewBox="0 0 24 24">
                          <path d="M3 6l3-3h12l3 3v12l-3 3H6l-3-3V6z"/>
                          <path d="M8 10l3-3 6 6-3 3-6-6z"/>
                        </svg>
                      </div>
                    {% endif %}
                  </div>
                {% endif %}
              {% endwith %}
            {% endfor %}
          </div>
        {% else %}
          <!-- No posts message -->
          <div class="bg-white border border-gray-300 rounded-lg p-12 text-center">
            <div class="w-20 h-20 mx-auto mb-6 bg-gray-100 rounded-full flex items-center justify-center">
              <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
            </div>
            <h3 class="text-xl font-semibold text-gray-900 mb-2">No Posts to Explore</h3>
            <p class="text-gray-500 mb-6">There are no public posts available yet. Be the first to create content!</p>
            <a href="{% url 'create_post' %}" class="inline-flex items-center px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
              </svg>
              Create Your First Post
            </a>
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <style>
    /* Mobile responsive grid */
    @media (max-width: 640px) {
      .grid {
        gap: 0.125rem;
      }
    }
    
    /* Ensure grid items maintain aspect ratio */
    .aspect-square {
      position: relative;
      padding-bottom: 100%;
      height: 0;
      overflow: hidden;
    }
    
    .aspect-square > * {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
  </style>

  <script>
    // Open post modal function (you can integrate with existing post modal)
    function openPostModal(postId) {
      // Redirect to post detail page or open modal
      // For now, let's redirect to home and trigger modal
      window.location.href = `/posts/${postId}/`;
    }
  </script>
{% endblock %}
